# ููุฎุต ุงูุชุญุฏูุซุงุช ูุงูุฅุตูุงุญุงุช

## ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. โ ูุดููุฉ ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ
**ุงููุดููุฉ:** ุฎุทุฃ `PGRST204: Could not find 'pin_hash' column`

**ุงูุญู:**
- ุฃุฒููุง ุงุณุชุฎุฏุงู ุนููุฏ `pin_hash` ูู `SupabaseEmployeeService`
- ุงูููุธููู ููุญูุธูู ุงูุขู ุจู `pin` ููุท (ุงูุญูู ุงูููุฌูุฏ ูุนููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)
- ุงููุฏูุฑ ููุฏุฑ ูุถูู ููุธููู ุฌุฏุฏ ูู ุจุทุงูุฉ "ุฅุถุงูุฉ ููุธู ูููุฑุน" ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `lib/services/supabase_employee_service.dart`
- `lib/screens/manager/manager_home_page.dart`

---

### 2. โ ูุดููุฉ ููุญุฉ ูุฏูุฑ ุงููุฑุน (ุฎุทุฃ 500)
**ุงููุดููุฉ:** 
- Edge Functions ุชุฑุฌุน ุฎุทุฃ 500 ุนูุฏ ุงุณุชุฏุนุงุก `branch-requests` ู `branch-pulse-summary`
- ุฑุณุงูุฉ ุงูุฎุทุฃ: "Failed to fetch employees"

**ุงูุญู:**
- ุญุฏุซูุง Edge Functions ูุชุชุนุงูู ูุน ุงูุฃุฎุทุงุก ุจุดูู ุฃูุถู
- ุฅุฐุง ูุดู ุฌูุจ ุงูููุธูููุ ุชุฑุฌุน ุจูุงูุงุช ูุงุฑุบุฉ ุจุฏูุงู ูู 500
- ุฃุตูุญูุง ูุดููุฉ foreign key relationships ูู ุฌูุจ ุงูุจูุงูุงุช

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `supabase/functions/branch-requests/index.ts`
- `supabase/functions/branch-pulse-summary/index.ts`
- `lib/screens/branch_manager_screen.dart`

---

### 3. โ ูุดููุฉ ุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช (PostgrestException)
**ุงููุดููุฉ:** ุฎุทุฃ `PGRST201: more than one relationship found`

**ุงูุญู:**
- ุญุฏุฏูุง ุงูุนูุงูุงุช ุงูุตุญูุญุฉ ุนูุฏ ุฌูุจ ุงูุจูุงูุงุช:
  - `leave_requests` โ `employees!leave_requests_employee_id_fkey`
  - `salary_advances` โ `employees!salary_advances_employee_id_fkey`
  - `attendance` โ `employees!attendance_employee_id_fkey`

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `lib/services/supabase_requests_service.dart`
- `lib/services/supabase_attendance_service.dart`

---

### 4. โ ูุธุงู ุงุญุชุณุงุจ ุงูุฃุฌูุฑ ูู ุงููุจุถุงุช
**ุงูุชุญุณููุงุช:**
- ุญุณุงุจ ุงูุฏูุงุฆู ุงููุนููุฉ ุจูู ุงููุจุถุงุช (ุจุฏูุงู ูู ุงูุชุฑุงุถ 5 ุฏูุงุฆู ููู ูุจุถุฉ)
- ูู ุฏูููุฉ = (ุฃุฌุฑ ุงูุณุงุนุฉ / 60)
- ุงูุฃุฌุฑ ููุญุณุจ ูู ุฃูู ุฏูููุฉ ุจุนุฏ ุชุณุฌูู ุงูุญุถูุฑ

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `supabase/functions/sync-pulses/index.ts`
- `lib/services/supabase_attendance_service.dart`

---

### 5. โ ูุธุงู ูุฑุงูุจุฉ ุงููุจุถุงุช
**ุงูุชุญุณููุงุช:**
- ูุฑุงูุจ ุฏุงุฎูู ููุญุต ูู ุฏูููุฉ ุขุฎุฑ ูุจุถุฉ ููุฑุณูุฉ
- ุฅุฐุง ุชูููุช ุงููุจุถุงุช ูุฃูุซุฑ ูู 6 ุฏูุงุฆูุ ููุนูุฏ ุฅุฑุณุงู ูุจุถุฉ ุชููุงุฆูุงู
- ูููุน ุชููู ุงุญุชุณุงุจ ุงูุฃุฌุฑ ุจุณุจุจ ุงููุทุงุน ูุคูุช ูู ุงููุธุงู

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `lib/services/pulse_tracking_service.dart`

---

### 6. โ ุดุงุดุฉ ุฌุฏูู ุงูุญุถูุฑ ูููุงูู
**ุงูุชุญุณููุงุช:**
- ุนุฑุถ ุงูุณุงุนุงุช ูุงูุฃุฌุฑ ุงููููู ููู ููุธู
- ููุฎุตุงุช ูุงููุฉ: ุฅุฌูุงูู ุงูุฃุฌูุฑุ ูุชูุณุท ุงูุณุงุนุงุช
- ููุฑุฃ ูู `daily_attendance_summary` ูุน fallback ููุฌุฏูู ุงููุฏูู

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `lib/screens/owner/owner_attendance_table_screen.dart`
- `lib/services/supabase_owner_service.dart`

---

### 7. โ ุทูุจุงุช ูุฏูุฑ ุงููุฑุน
**ุงูุฅุตูุงุญ:**
- ุชุญุฏูุซ ุฌููุน ุชุจููุจุงุช ุงูุทูุจุงุช (ุงูุญุถูุฑุ ุงูุฅุฌุงุฒุงุชุ ุงูุณูู) ูุงุณุชุฎุฏุงู Supabase ุจุฏูุงู ูู AWS
- ุงุณุชุฎุฏุงู `BranchManagerApiService.getBranchRequests()` ูุฌูุจ ุงูุทูุจุงุช

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `lib/screens/manager/manager_attendance_requests_tab.dart`
- `lib/screens/manager/manager_leave_requests_tab.dart`
- `lib/screens/manager/manager_advance_requests_tab.dart`

---

## ุฎุทูุงุช ุงูุชุดุบูู

### 1. ุชุญุฏูุซ ุงูุชุจุนูุงุช
```powershell
flutter pub get
```

### 2. ูุดุฑ Edge Functions ุงููุญุฏุซุฉ
```powershell
# ุชุดุบูู ุณูุฑูุจุช ุงููุดุฑ ุงูุชููุงุฆู
.\DEPLOY_UPDATES.bat

# ุฃู ูุฏููุงู:
supabase functions deploy sync-pulses --no-verify-jwt
supabase functions deploy branch-requests --no-verify-jwt
supabase functions deploy branch-pulse-summary --no-verify-jwt
```

### 3. ุชุดุบูู ุงูุชุทุจูู
```powershell
# ููููุจ (Edge/Chrome)
flutter run -d edge

# ููููุจุงูู
flutter run -d <device-id>

# ูุณุทุญ ุงูููุชุจ (Windows)
flutter run -d windows
```

---

## ุงุฎุชุจุงุฑ ุงูููุฒุงุช

### ูุธุงู ุงููุจุถุงุช
1. ุณุฌู ุญุถูุฑ ููุธู
2. ุฑุงูุจ console - ูุฌุจ ุฃู ุชุฑู:
   - `๐ฏ Starting pulse tracking`
   - `โ Pulse #1: accepted via GPS (XX.Xm from center)`
   - ูุจุถุงุช ูู 5 ุฏูุงุฆู

3. ุงูุตู ุงูุฅูุชุฑูุช:
   - ุงููุจุถุงุช ุชูุญูุธ ูุญููุงู ูู SQLite/Hive
   - ุฑุณุงูุฉ "๐ด ุชู ุญูุธ ุงููุจุถุฉ ูุญููุงู"

4. ุฃุนุฏ ุชุดุบูู ุงูุฅูุชุฑูุช:
   - ุงููุจุถุงุช ุชูุฑูุน ุชููุงุฆูุงู
   - ุฑุณุงูุฉ "โ ุชู ุฑูุน X ูุจุถุฉ ุจูุฌุงุญ"

### ุงุญุชุณุงุจ ุงูุฃุฌูุฑ
1. ุณุฌู ุญุถูุฑ + ุงูุตุฑุงู
2. ุงูุชุญ ุดุงุดุฉ "ุฌุฏูู ุงูุญุถูุฑ" (ุงููุงูู)
3. ูุฌุจ ุฃู ุชุฑู:
   - ููุช ุงูุญุถูุฑ ูุงูุงูุตุฑุงู
   - ุฅุฌูุงูู ุงูุณุงุนุงุช
   - ุงูุฃุฌุฑ ุงููููู ุงููุญุณูุจ

### ุฅุถุงูุฉ ููุธู (ุงููุฏูุฑ)
1. ุงูุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูููุฏูุฑ
2. ุงุถุบุท "ุฅุถุงูุฉ ููุธู ูููุฑุน"
3. ุงููุฃ ุงูุจูุงูุงุช (ุงูุงุณูุ PINุ ุงูุฏูุฑุ ุงูุฃุฌุฑ)
4. ุงุถุบุท "ุฅุถุงูุฉ ููุธู"
5. ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ูุฌุงุญ ูุน ูุนุฑู ุงูููุธู ูุงูู PIN

### ููุญุฉ ูุฏูุฑ ุงููุฑุน
1. ุงูุชุญ ููุญุฉ ุงููุฏูุฑ (ุฒุฑ ูู AppBar)
2. ูุฌุจ ุฃู ุชุฑู:
   - ุฅุญุตุงุฆูุงุช ุงููุจุถุงุช
   - ุชูุฑูุฑ ุงูุญุถูุฑ
   - ุงูุทูุจุงุช ุงููุนููุฉ
3. ุจุฏูู ุฃุฎุทุงุก 500

---

## ููุงุญุธุงุช ูุงูุฉ

### ูุธุงู ุงููุจุถุงุช
- ุงููุจุถุฉ ุงูุฃููู ุชูุฑุณู ููุฑุงู ุจุนุฏ ุชุณุฌูู ุงูุญุถูุฑ
- ุงููุจุถุงุช ุงูุชุงููุฉ ูู 5 ุฏูุงุฆู
- ูุฑุงูุจ ุฏุงุฎูู ููุญุต ูู ุฏูููุฉ ูููุนูุฏ ุฅุฑุณุงู ูุจุถุฉ ุฅุฐุง ุชููู ุงููุธุงู
- ุงููุจุถุงุช ุฎุงุฑุฌ ุงูุฌููููุณ:
  - **ุงููุฑุฉ ุงูุฃููู:** ุชุญุฐูุฑ ููุท + ุชูุญุชุณุจ
  - **ุงููุฑุฉ ุงูุซุงููุฉ:** ุนููุจุฉ + ูุง ุชูุญุชุณุจ ุงูู5 ุฏูุงุฆู ุงููุงุฏูุฉ

### ุงุญุชุณุงุจ ุงูุฃุฌูุฑ
- ุงูุฃุฌุฑ ููุญุณุจ ุจูุงุกู ุนูู ุงูุฏูุงุฆู ุงููุนููุฉ ุจูู ุงููุจุถุงุช
- ุงูุตูุบุฉ: `(ุฏูุงุฆู ุงูุนูู / 60) ร ุฃุฌุฑ ุงูุณุงุนุฉ`
- ุงูุชุญุฏูุซ ูู `daily_attendance_summary` ูุญุตู ุชููุงุฆูุงู ุนูุฏ:
  - ุชุณุฌูู ุงูุญุถูุฑ
  - ุชุณุฌูู ุงูุงูุตุฑุงู
  - ุฑูุน ุงููุจุถุงุช (sync-pulses)

### ุงููุถุน ุงูุฃูููุงูู
- ุฌููุน ุงูุจูุงูุงุช ุชูุญูุธ ูุญููุงู (SQLite ุนูู Mobileุ Hive ุนูู Web)
- ุงูุฑูุน ุงูุชููุงุฆู ุนูุฏ ุนูุฏุฉ ุงูุฅูุชุฑูุช
- ุงูููุธู ููุฏุฑ ูุณุฌู ุญุถูุฑ/ุงูุตุฑุงู ุจุฏูู ุฅูุชุฑูุช

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูู ุชุธูุฑ ุงููุจุถุงุช:
1. ุชุฃูุฏ ูู ุชูุฒูู ุจูุงูุงุช ุงููุฑุน (ุฒุฑ "ุชูุฒูู ุจูุงูุงุช ุงููุฑุน")
2. ุฑุงุฌุน console ููุจุญุซ ุนู ุฑุณุงุฆู `โ`
3. ุชุฃูุฏ ูู ุฃู ุงูููุธู ูุฏูู `branch_id` ุตุญูุญ

### ุฅุฐุง ูู ุชุธูุฑ ุงูุฃุฌูุฑ:
1. ุชุฃูุฏ ูู ุฃู ุงูููุธู ูุฏูู `hourly_rate` ูุญุฏุฏ
2. ุฑุงุฌุน ุฌุฏูู `daily_attendance_summary` ูู Supabase
3. ุฅุฐุง ูุงู ูุงุฑุบุงูุ ุฑุงุฌุน Edge Function logs ูู Supabase Dashboard

### ุฅุฐุง ูุดู ุฑูุน ุงูุจูุงูุงุช:
1. ุฑุงุฌุน console ููุจุญุซ ุนู `โ Error syncing`
2. ุชุฃูุฏ ูู ุตุญุฉ `SUPABASE_URL` ู `SERVICE_ROLE_KEY`
3. ุชุฃูุฏ ูู ูุดุฑ Edge Functions

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

1. **ุชุญุณูู ุงูุฃูุงู:**
   - ุฅุถุงูุฉ ุนููุฏ `pin_hash` ูุชุฎุฒูู PIN ูุดูุฑ
   - ุงุณุชุฎุฏุงู `crypto` package ูุชุดููุฑ PIN

2. **ุชุญุณููุงุช ุงููุงุฌูุฉ:**
   - ุฅุถุงูุฉ ุฑุณูู ุจูุงููุฉ ูุฅุญุตุงุฆูุงุช ุงููุจุถุงุช
   - ุนุฑุถ ุฎุฑูุทุฉ ูููุงูุน ุงููุจุถุงุช

3. **ููุฒุงุช ุฅุถุงููุฉ:**
   - ุชูุจููุงุช ููููุธููู ุนูุฏ ุงูุชุฑุงุจ ููุงูุฉ ุงูุดููุช
   - ุชูุงุฑูุฑ ุดูุฑูุฉ ุชููุงุฆูุฉ ููุฃุฌูุฑ

---

## ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุฑุงุฌุน console logs ููุจุญุซ ุนู ุฑุณุงุฆู ุงูุฎุทุฃ
2. ุชุญูู ูู Supabase Dashboard โ Edge Functions โ Logs
3. ุชุฃูุฏ ูู ุตุญุฉ ุจูุงูุงุช ุงูุงุชุตุงู ูู `.env` ุฃู `supabase_config.dart`

---

**ุขุฎุฑ ุชุญุฏูุซ:** 13 ููููุจุฑ 2025

